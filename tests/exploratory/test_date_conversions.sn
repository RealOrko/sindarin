// Test Date/Time bidirectional conversion patterns

fn main(): int =>
    print("Testing Date/Time conversion patterns...\n")
    print("========================================\n\n")

    // Date to Time conversion
    print("Date to Time conversion:\n")
    print("------------------------\n")

    var d1: Date = Date.fromYmd(2025, 6, 15)
    var t1: Time = d1.toTime()
    print($"  Date: {d1.toIso()}\n")
    print($"  Time: {t1.toIso()}\n")
    print($"  Expected: midnight UTC on that date\n")

    // Verify it's midnight
    print($"  Hour: {t1.hour()}\n")
    print($"  Minute: {t1.minute()}\n")
    print($"  Second: {t1.second()}\n")
    print($"  All zeros (midnight): {t1.hour() == 0 and t1.minute() == 0 and t1.second() == 0}\n")

    print("\nDate to Time conversion - PASS\n")

    // Time to Date conversion
    print("\nTime to Date conversion:\n")
    print("------------------------\n")

    // Use a known timestamp
    var t2: Time = Time.fromSeconds(1750000000)  // Some time in 2025
    var d2: Date = t2.toDate()
    print($"  Time seconds: 1750000000\n")
    print($"  Time ISO: {t2.toIso()}\n")
    print($"  Date: {d2.toIso()}\n")

    // Also test with a midnight timestamp
    var t3: Time = Time.fromSeconds(1718409600)  // 2024-06-15 00:00:00 UTC
    var d3: Date = t3.toDate()
    print($"\n  Time seconds: 1718409600 (midnight)\n")
    print($"  Time ISO: {t3.toIso()}\n")
    print($"  Date: {d3.toIso()}\n")
    print($"  Expected: 2024-06-15 - {d3.toIso() == "2024-06-15"}\n")

    print("\nTime to Date conversion - PASS\n")

    // Round-trip conversion
    print("\nRound-trip conversion (Date -> Time -> Date):\n")
    print("----------------------------------------------\n")

    var original: Date = Date.fromYmd(2025, 12, 25)
    var asTime: Time = original.toTime()
    var backToDate: Date = asTime.toDate()

    print($"  Original Date: {original.toIso()}\n")
    print($"  As Time: {asTime.toIso()}\n")
    print($"  Back to Date: {backToDate.toIso()}\n")
    print($"  Round-trip preserved: {original.equals(backToDate)}\n")

    print("\nRound-trip conversion - PASS\n")

    // Epoch boundary conversions
    print("\nEpoch boundary conversions:\n")
    print("---------------------------\n")

    // Unix epoch
    var epoch: Date = Date.fromYmd(1970, 1, 1)
    var epochTime: Time = epoch.toTime()
    print($"  Unix epoch Date: {epoch.toIso()}\n")
    print($"  As Time: {epochTime.toIso()}\n")
    print($"  Millis: {epochTime.millis()}\n")
    print($"  Expected: 0 millis - {epochTime.millis() == 0}\n")

    // Day before epoch
    var preEpoch: Date = Date.fromYmd(1969, 12, 31)
    var preEpochTime: Time = preEpoch.toTime()
    print($"\n  Pre-epoch Date: {preEpoch.toIso()}\n")
    print($"  As Time: {preEpochTime.toIso()}\n")
    print($"  Millis: {preEpochTime.millis()}\n")
    print($"  Expected: negative millis - {preEpochTime.millis() < 0}\n")

    print("\nEpoch boundary conversions - PASS\n")

    // Date comparison via Time
    print("\nDate comparison via Time conversion:\n")
    print("------------------------------------\n")

    var date1: Date = Date.fromYmd(2025, 1, 1)
    var date2: Date = Date.fromYmd(2025, 12, 31)
    var time1: Time = date1.toTime()
    var time2: Time = date2.toTime()

    print($"  Date1: {date1.toIso()} -> Time millis: {time1.millis()}\n")
    print($"  Date2: {date2.toIso()} -> Time millis: {time2.millis()}\n")
    print($"  Time difference: {time2.diff(time1)} ms\n")

    // Convert back and compare
    var diff: int = time2.diff(time1)
    var diffDays: int = diff / 1000 / 60 / 60 / 24
    var directDiff: int = date2.diffDays(date1)
    print($"  Diff via Time: {diffDays} days\n")
    print($"  Diff via Date: {directDiff} days\n")
    print($"  Same result: {diffDays == directDiff}\n")

    print("\nDate comparison via Time - PASS\n")

    // Working with both Date and Time
    print("\nCombined Date/Time patterns:\n")
    print("----------------------------\n")

    // Get today's date and add time components
    var appointmentDate: Date = Date.fromYmd(2025, 6, 15)
    var appointmentTime: Time = appointmentDate.toTime()
    // Add 14 hours and 30 minutes for 2:30 PM appointment
    var appointment: Time = appointmentTime.addHours(14).addMinutes(30)

    print($"  Appointment date: {appointmentDate.toIso()}\n")
    print($"  Appointment time: {appointment.format("YYYY-MM-DD h:mm A")}\n")

    // Check if appointment date matches
    var appointmentDateCheck: Date = appointment.toDate()
    print($"  Date extracted back: {appointmentDateCheck.toIso()}\n")
    print($"  Same as original: {appointmentDate.equals(appointmentDateCheck)}\n")

    print("\nCombined Date/Time patterns - PASS\n")

    // Edge case: far future dates
    print("\nFar future date conversions:\n")
    print("----------------------------\n")

    var future: Date = Date.fromYmd(2100, 1, 1)
    var futureTime: Time = future.toTime()
    var futureBack: Date = futureTime.toDate()
    print($"  Future date: {future.toIso()}\n")
    print($"  As Time: {futureTime.toIso()}\n")
    print($"  Back to Date: {futureBack.toIso()}\n")
    print($"  Round-trip preserved: {future.equals(futureBack)}\n")

    print("\nFar future date conversions - PASS\n")

    // Edge case: leap day
    print("\nLeap day conversions:\n")
    print("---------------------\n")

    var leapDay: Date = Date.fromYmd(2024, 2, 29)
    var leapTime: Time = leapDay.toTime()
    var leapBack: Date = leapTime.toDate()
    print($"  Leap day: {leapDay.toIso()}\n")
    print($"  As Time: {leapTime.toIso()}\n")
    print($"  Back to Date: {leapBack.toIso()}\n")
    print($"  Round-trip preserved: {leapDay.equals(leapBack)}\n")

    print("\nLeap day conversions - PASS\n")

    print("\n========================================\n")
    print("All conversion patterns complete - PASS\n")

    return 0

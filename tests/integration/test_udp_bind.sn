// Test: UDP bind operations
// Tests UdpSocket.bind and port property

fn main(): void =>
    // Test 1: Bind to localhost with OS-assigned port
    var socket1: UdpSocket = UdpSocket.bind("127.0.0.1:0")
    var port1: int = socket1.port

    if port1 > 0 =>
        print("Test 1 PASS: Bound with valid port\n")
    else =>
        print("Test 1 FAIL: Invalid port\n")

    // Test 2: Port should be in valid range
    if port1 >= 1024 =>
        if port1 <= 65535 =>
            print("Test 2 PASS: Port in valid range\n")
        else =>
            print("Test 2 FAIL: Port too high\n")
    else =>
        print("Test 2 FAIL: Port too low\n")

    // Clean up first socket
    socket1.close()

    // Test 3: Can bind another socket after close
    var socket2: UdpSocket = UdpSocket.bind("127.0.0.1:0")
    var port2: int = socket2.port

    if port2 > 0 =>
        print("Test 3 PASS: Second bind successful\n")
    else =>
        print("Test 3 FAIL: Second bind failed\n")

    // Test 4: Two sockets get different ports
    var socket3: UdpSocket = UdpSocket.bind("127.0.0.1:0")
    var port3: int = socket3.port

    if port2 != port3 =>
        print("Test 4 PASS: Different ports assigned\n")
    else =>
        print("Test 4 FAIL: Same port assigned to both\n")

    socket2.close()
    socket3.close()
    print("All bind tests complete\n")

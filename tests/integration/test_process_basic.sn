// Test basic Process.run functionality
// Uses the Sindarin compiler itself for cross-platform testing

fn main(): int =>
    // Get compiler path (cross-platform, absolute path required)
    var sn: str = Path.absolute("bin/sn")
    if Environment.get("OS", "").contains("Windows") =>
        sn = Path.absolute("bin/sn.exe")

    // Test 1: Exit code 0
    var p1: Process = Process.run(sn, {"--version"})
    print($"exit code 0: {p1.exitCode}\n")

    // Test 2: Exit code 1 (compile error)
    var p2: Process = Process.run(sn, {"nonexistent.sn", "--emit-c"})
    print($"exit code 1: {p2.exitCode}\n")

    // Test 3: Command not found
    var p3: Process = Process.run("nonexistent_command_xyz123")
    print($"command not found: {p3.exitCode}\n")

    // Test 4: Read stdout
    var p4: Process = Process.run(sn, {"--version"})
    print($"version output: {p4.stdout.trim()}\n")

    // Test 5: Read stdout with help
    var p5: Process = Process.run(sn, {"--help"})
    var helpLine: str = p5.stdout.split("\n")[0].trim()  // trim() for Windows CRLF
    print($"help first line: {helpLine}\n")

    return 0

// Test fire-and-forget pattern with Process
// Uses the Sindarin compiler itself for cross-platform testing
// Process runs in background, arena cleanup joins thread

fn main(): int =>
    // Get compiler path (cross-platform)
    var sn: str = Path.absolute("bin/sn")
    if Environment.get("OS", "").contains("Windows") =>
        sn = Path.absolute("bin/sn.exe")

    // Fire and forget - spawn but don't sync
    var p: Process = &Process.run(sn, {"--version"})

    // Continue immediately without waiting
    print("fired\n")

    // Do some other work
    var x: int = 1 + 2
    print($"work done: {x}\n")

    // Process will be auto-joined when arena is destroyed
    print("exiting\n")

    return 0

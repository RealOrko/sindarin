// Test command execution with various arguments
// Uses the Sindarin compiler itself for cross-platform testing

fn main(): int =>
    // Get compiler path (cross-platform)
    var sn: str = Path.absolute("bin/sn")
    if Environment.get("OS", "").contains("Windows") =>
        sn = Path.absolute("bin/sn.exe")

    // Basic command
    var p1: Process = Process.run(sn, {"--version"})
    print($"version: {p1.stdout.trim()}\n")

    // Help output (multiline)
    var p2: Process = Process.run(sn, {"--help"})
    var firstLine: str = p2.stdout.split("\n")[0].trim()
    print($"help: {firstLine}\n")

    // Multiple flags
    var p3: Process = Process.run(sn, {"-O0", "--version"})
    print($"flags: {p3.stdout.trim()}\n")

    // Error case
    var p4: Process = Process.run(sn, {"missing.sn", "--emit-c"})
    print($"error exit: {p4.exitCode}\n")

    // Help line count
    var p5: Process = Process.run(sn, {"--help"})
    var lines: str[] = p5.stdout.split("\n")
    print($"multiline: {lines.length > 5}\n")

    return 0

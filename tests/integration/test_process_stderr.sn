// Test Process stderr capture
// Uses the Sindarin compiler itself for cross-platform testing

fn main(): int =>
    // Get compiler path (cross-platform)
    var sn: str = Path.absolute("bin/sn")
    if Environment.get("OS", "").contains("Windows") =>
        sn = Path.absolute("bin/sn.exe")

    // Run command that writes to stderr (compile error)
    var p: Process = Process.run(sn, {"nonexistent.sn", "--emit-c"})

    // stdout should be empty for error case
    if p.stdout.trim().length == 0 =>
        print("stdout is empty: true\n")
    else =>
        print("stdout is empty: false\n")

    // stderr should contain error message
    var hasError: bool = p.stderr.contains("error") || p.stderr.contains("ERROR")
    print($"stderr has error: {hasError}\n")

    // Exit code should be non-zero
    print($"exit code non-zero: {p.exitCode != 0}\n")

    return 0

// Test Process stdout and stderr capture
// Uses the Sindarin compiler itself for cross-platform testing

fn main(): int =>
    // Get compiler path (cross-platform)
    var sn: str = Path.absolute("bin/sn")
    if Environment.get("OS", "").contains("Windows") =>
        sn = Path.absolute("bin/sn.exe")

    // Test stdout capture
    var p1: Process = Process.run(sn, {"--version"})
    print($"stdout: {p1.stdout.trim()}\n")

    // Test stderr capture (compile error goes to stderr)
    var p2: Process = Process.run(sn, {"nonexistent.sn", "--emit-c"})
    var hasError: bool = p2.stderr.contains("error") || p2.stderr.contains("ERROR")
    print($"stderr has error: {hasError}\n")

    // Test multiline output
    var p3: Process = Process.run(sn, {"--help"})
    var lines: str[] = p3.stdout.split("\n")
    print($"multiline count: {lines.length > 10}\n")

    // Test stdout when there's also stderr
    var p4: Process = Process.run(sn, {"nonexistent.sn", "--emit-c"})
    print($"stdout empty on error: {p4.stdout.trim().length == 0}\n")

    return 0

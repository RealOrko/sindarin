// Integration tests for Random collection operations
// Tests: choice, shuffle, weightedChoice, sample
// Uses seeded RNG for deterministic output

fn main(): int =>
    print("=== Random Collection Operations ===\n")

    test_choice_int()
    test_choice_str()
    test_shuffle_int()
    test_shuffle_str()
    test_weighted_choice()
    test_sample_int()
    test_sample_str()

    print("\nPASS\n")
    return 0

fn test_choice_int(): void =>
    print("Testing choice(int[])...\n")
    var rng: Random = Random.createWithSeed(100l)
    var numbers: int[] = {10, 20, 30, 40, 50}

    var all_valid: bool = true
    for i in 0..10 =>
        var pick: int = rng.choice(numbers)
        var is_valid: bool = (pick == 10) || (pick == 20) || (pick == 30) || (pick == 40) || (pick == 50)
        if !is_valid =>
            all_valid = false

    if all_valid =>
        print("  PASS: choice(int[]) returns valid values\n")
    else =>
        print("  FAIL: choice(int[]) returned invalid values\n")

fn test_choice_str(): void =>
    print("Testing choice(str[])...\n")
    var rng: Random = Random.createWithSeed(200l)
    var colors: str[] = {"red", "green", "blue"}

    var all_valid: bool = true
    for i in 0..10 =>
        var pick: str = rng.choice(colors)
        var is_valid: bool = (pick == "red") || (pick == "green") || (pick == "blue")
        if !is_valid =>
            all_valid = false

    if all_valid =>
        print("  PASS: choice(str[]) returns valid values\n")
    else =>
        print("  FAIL: choice(str[]) returned invalid values\n")

fn test_shuffle_int(): void =>
    print("Testing shuffle(int[])...\n")
    var rng: Random = Random.createWithSeed(300l)
    var numbers: int[] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
    var original_sum: int = 0
    for n in numbers =>
        original_sum = original_sum + n

    rng.shuffle(numbers)

    var shuffled_sum: int = 0
    for n in numbers =>
        shuffled_sum = shuffled_sum + n

    if original_sum == shuffled_sum =>
        print("  PASS: shuffle(int[]) preserves all elements\n")
    else =>
        print("  FAIL: shuffle changed element sum\n")

fn test_shuffle_str(): void =>
    print("Testing shuffle(str[])...\n")
    var rng: Random = Random.createWithSeed(400l)
    var words: str[] = {"apple", "banana", "cherry"}
    var original_len: int = words.length

    rng.shuffle(words)

    if words.length == original_len =>
        print("  PASS: shuffle(str[]) preserves length\n")
    else =>
        print("  FAIL: shuffle changed length\n")

fn test_weighted_choice(): void =>
    print("Testing weightedChoice...\n")
    var rng: Random = Random.createWithSeed(500l)
    var items: int[] = {100, 200, 300}
    var weights: double[] = {0.7, 0.2, 0.1}

    var count_100: int = 0
    var count_200: int = 0
    var count_300: int = 0

    for i in 0..100 =>
        var pick: int = rng.weightedChoice(items, weights)
        if pick == 100 => count_100 = count_100 + 1
        if pick == 200 => count_200 = count_200 + 1
        if pick == 300 => count_300 = count_300 + 1

    var total: int = count_100 + count_200 + count_300
    if total == 100 =>
        print("  PASS: weightedChoice returns valid values\n")
    else =>
        print("  FAIL: weightedChoice missed some picks\n")

fn test_sample_int(): void =>
    print("Testing sample(int[])...\n")
    var rng: Random = Random.createWithSeed(600l)
    var numbers: int[] = {10, 20, 30, 40, 50, 60, 70, 80, 90, 100}

    var sample: int[] = rng.sample(numbers, 5)

    if sample.length == 5 =>
        print("  PASS: sample returns correct length\n")
    else =>
        print("  FAIL: sample returned wrong length\n")

    var all_valid: bool = true
    for s in sample =>
        var found: bool = false
        for n in numbers =>
            if s == n =>
                found = true
        if !found =>
            all_valid = false

    if all_valid =>
        print("  PASS: sample returns values from original\n")
    else =>
        print("  FAIL: sample returned invalid values\n")

fn test_sample_str(): void =>
    print("Testing sample(str[])...\n")
    var rng: Random = Random.createWithSeed(700l)
    var words: str[] = {"alpha", "beta", "gamma", "delta", "epsilon"}

    var sample: str[] = rng.sample(words, 3)

    if sample.length == 3 =>
        print("  PASS: sample(str[]) returns correct length\n")
    else =>
        print("  FAIL: sample(str[]) returned wrong length\n")

    var all_valid: bool = true
    for s in sample =>
        var found: bool = false
        for w in words =>
            if s == w =>
                found = true
        if !found =>
            all_valid = false

    if all_valid =>
        print("  PASS: sample(str[]) returns values from original\n")
    else =>
        print("  FAIL: sample(str[]) returned invalid values\n")

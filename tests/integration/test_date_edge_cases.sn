// Test Date type edge cases: month-end clamping, leap years, boundaries

fn main(): int =>
    // Month-end clamping with addMonths
    print("=== Month-End Clamping ===\n")

    // Jan 31 + 1 month = Feb 28 (or 29 in leap year)
    var jan31: Date = Date.fromYmd(2025, 1, 31)
    print($"Jan 31: {jan31.toIso()}\n")
    print($"Jan 31 + 1 month: {jan31.addMonths(1).toIso()}\n")

    // Jan 31 in leap year + 1 month = Feb 29
    var jan31Leap: Date = Date.fromYmd(2024, 1, 31)
    print($"Jan 31 (2024): {jan31Leap.toIso()}\n")
    print($"Jan 31 (2024) + 1 month: {jan31Leap.addMonths(1).toIso()}\n")

    // Mar 31 + 1 month = Apr 30
    var mar31: Date = Date.fromYmd(2025, 3, 31)
    print($"Mar 31: {mar31.toIso()}\n")
    print($"Mar 31 + 1 month: {mar31.addMonths(1).toIso()}\n")

    // Aug 31 - 1 month = Jul 31
    var aug31: Date = Date.fromYmd(2025, 8, 31)
    print($"Aug 31: {aug31.toIso()}\n")
    print($"Aug 31 - 1 month: {aug31.addMonths(-1).toIso()}\n")

    // Leap year edge cases with addYears
    print("\n=== Leap Year Clamping ===\n")

    // Feb 29 + 1 year = Feb 28
    var feb29: Date = Date.fromYmd(2024, 2, 29)
    print($"Feb 29 2024: {feb29.toIso()}\n")
    print($"Feb 29 + 1 year: {feb29.addYears(1).toIso()}\n")
    print($"Feb 29 + 4 years: {feb29.addYears(4).toIso()}\n")

    // Feb 29 - 1 year = Feb 28
    print($"Feb 29 - 1 year: {feb29.addYears(-1).toIso()}\n")

    // Epoch boundary
    print("\n=== Epoch Boundary ===\n")
    var epoch: Date = Date.fromYmd(1970, 1, 1)
    print($"Unix epoch: {epoch.toIso()}\n")
    print($"epochDays(): {epoch.epochDays()}\n")
    print($"epoch - 1 day: {epoch.addDays(-1).toIso()}\n")
    print($"1969-12-31 epochDays: {epoch.addDays(-1).epochDays()}\n")

    // Year boundary crossing
    print("\n=== Year Boundary Crossing ===\n")
    var dec31: Date = Date.fromYmd(2024, 12, 31)
    print($"Dec 31 2024: {dec31.toIso()}\n")
    print($"Dec 31 + 1 day: {dec31.addDays(1).toIso()}\n")
    print($"Dec 31 + 1 month: {dec31.addMonths(1).toIso()}\n")

    var jan1: Date = Date.fromYmd(2025, 1, 1)
    print($"Jan 1 2025: {jan1.toIso()}\n")
    print($"Jan 1 - 1 day: {jan1.addDays(-1).toIso()}\n")
    print($"Jan 1 - 1 month: {jan1.addMonths(-1).toIso()}\n")

    // Large value tests
    print("\n=== Large Values ===\n")
    var d: Date = Date.fromYmd(2025, 6, 15)
    print($"Start: {d.toIso()}\n")
    print($"+ 100 months: {d.addMonths(100).toIso()}\n")
    print($"- 100 months: {d.addMonths(-100).toIso()}\n")
    print($"+ 50 years: {d.addYears(50).toIso()}\n")
    print($"- 50 years: {d.addYears(-50).toIso()}\n")

    // Century boundary - 1900 is not a leap year, 2000 is
    print("\n=== Century Leap Year Rules ===\n")
    print($"1900 leap year: {Date.isLeapYear(1900)}\n")
    print($"2000 leap year: {Date.isLeapYear(2000)}\n")
    print($"2100 leap year: {Date.isLeapYear(2100)}\n")
    print($"2400 leap year: {Date.isLeapYear(2400)}\n")

    // Days in Feb for century years
    print($"Feb 1900 days: {Date.daysInMonth(1900, 2)}\n")
    print($"Feb 2000 days: {Date.daysInMonth(2000, 2)}\n")

    // Far future/past dates
    print("\n=== Far Future/Past ===\n")
    var future: Date = Date.fromYmd(3000, 6, 15)
    print($"Year 3000: {future.toIso()}\n")
    print($"Year 3000 weekday: {future.weekday()}\n")

    var past: Date = Date.fromYmd(1500, 6, 15)
    print($"Year 1500: {past.toIso()}\n")
    print($"Year 1500 weekday: {past.weekday()}\n")

    // Day of year edge cases
    print("\n=== Day of Year ===\n")
    var jan1_2025: Date = Date.fromYmd(2025, 1, 1)
    var dec31_2025: Date = Date.fromYmd(2025, 12, 31)
    print($"Jan 1 2025 dayOfYear: {jan1_2025.dayOfYear()}\n")
    print($"Dec 31 2025 dayOfYear: {dec31_2025.dayOfYear()}\n")

    // Leap year day of year
    var dec31_2024: Date = Date.fromYmd(2024, 12, 31)
    print($"Dec 31 2024 (leap) dayOfYear: {dec31_2024.dayOfYear()}\n")

    // Weekend/weekday verification
    print("\n=== Weekend/Weekday ===\n")
    // 2025-01-04 is Saturday, 2025-01-05 is Sunday
    var sat: Date = Date.fromYmd(2025, 1, 4)
    var sun: Date = Date.fromYmd(2025, 1, 5)
    var mon: Date = Date.fromYmd(2025, 1, 6)
    print($"Sat {sat.toIso()} isWeekend: {sat.isWeekend()}\n")
    print($"Sat {sat.toIso()} isWeekday: {sat.isWeekday()}\n")
    print($"Sun {sun.toIso()} isWeekend: {sun.isWeekend()}\n")
    print($"Mon {mon.toIso()} isWeekend: {mon.isWeekend()}\n")
    print($"Mon {mon.toIso()} isWeekday: {mon.isWeekday()}\n")

    print("\nPASS\n")
    return 0

# Test string-to-byte conversions and round-trip encoding/decoding

fn main(): int =>
    # Test str.toBytes() - encodes string to UTF-8 byte array
    var hello: str = "Hello"
    var hello_bytes: byte[] = hello.toBytes()
    print("toBytes length: ")
    println(hello_bytes.length)

    # Verify the bytes are correct (H=72, e=101, l=108, l=108, o=111)
    # Note: bytes print in hex format (0x48), so we show that format
    print("First byte (H): ")
    println(hello_bytes[0])
    print("Last byte (o): ")
    println(hello_bytes[4])

    # Test round-trip: string -> bytes -> string
    var roundtrip1: str = hello_bytes.toString()
    print("Round-trip string: ")
    println(roundtrip1)

    # Test Bytes.fromHex() - decode hex string to byte array
    var hex_decoded: byte[] = Bytes.fromHex("48656c6c6f")
    var from_hex: str = hex_decoded.toString()
    print("fromHex result: ")
    println(from_hex)

    # Test round-trip: bytes -> hex -> bytes
    var original_bytes: byte[] = {65, 66, 67}  # ABC
    var hex_str: str = original_bytes.toHex()
    print("toHex: ")
    println(hex_str)
    var decoded_from_hex: byte[] = Bytes.fromHex(hex_str)
    var roundtrip2: str = decoded_from_hex.toString()
    print("Hex round-trip: ")
    println(roundtrip2)

    # Test Bytes.fromBase64() - decode Base64 string to byte array
    var b64_decoded: byte[] = Bytes.fromBase64("SGVsbG8=")
    var from_b64: str = b64_decoded.toString()
    print("fromBase64 result: ")
    println(from_b64)

    # Test round-trip: bytes -> base64 -> bytes
    var test_bytes: byte[] = {77, 97, 110}  # Man
    var b64_str: str = test_bytes.toBase64()
    print("toBase64: ")
    println(b64_str)
    var decoded_from_b64: byte[] = Bytes.fromBase64(b64_str)
    var roundtrip3: str = decoded_from_b64.toString()
    print("Base64 round-trip: ")
    println(roundtrip3)

    # Test with empty strings
    var empty_str: str = ""
    var empty_bytes: byte[] = empty_str.toBytes()
    print("Empty string bytes length: ")
    println(empty_bytes.length)

    var empty_hex: byte[] = Bytes.fromHex("")
    print("Empty hex bytes length: ")
    println(empty_hex.length)

    var empty_b64: byte[] = Bytes.fromBase64("")
    print("Empty base64 bytes length: ")
    println(empty_b64.length)

    # Test with uppercase hex (should also work)
    var upper_hex: byte[] = Bytes.fromHex("4142")
    var upper_result: str = upper_hex.toString()
    print("Uppercase hex result: ")
    println(upper_result)

    # Test Base64 with padding variations
    # TWFu = Man (no padding)
    # TWE= = Ma (1 padding)
    # TQ== = M (2 padding)
    var b64_no_pad: byte[] = Bytes.fromBase64("TWFu")
    print("Base64 no padding: ")
    println(b64_no_pad.toString())

    var b64_one_pad: byte[] = Bytes.fromBase64("TWE=")
    print("Base64 one padding: ")
    println(b64_one_pad.toString())

    var b64_two_pad: byte[] = Bytes.fromBase64("TQ==")
    print("Base64 two padding: ")
    println(b64_two_pad.toString())

    print("All string-to-bytes tests completed!\n")
    return 0

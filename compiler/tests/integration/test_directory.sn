# Test Directory operations

fn main(): int =>
    var testDir: str = "/tmp/sn_test_dir"

    # Clean up any previous test run
    if Path.exists(testDir) =>
        Directory.deleteRecursive(testDir)

    # Test Directory.create - creates directory with parents
    var nestedDir: str = Path.join(testDir, "sub1", "sub2")
    Directory.create(nestedDir)

    print("Created nested directory: ")
    println(Path.exists(nestedDir))
    println(Path.isDirectory(nestedDir))

    # Create some test files
    var file1: str = Path.join(testDir, "file1.txt")
    var file2: str = Path.join(testDir, "file2.txt")
    var subFile: str = Path.join(testDir, "sub1", "subfile.txt")

    TextFile.writeAll(file1, "test content 1")
    TextFile.writeAll(file2, "test content 2")
    TextFile.writeAll(subFile, "sub content")

    print("Created files: ")
    println(Path.exists(file1))

    # Test Directory.list - non-recursive listing
    var files: str[] = Directory.list(testDir)
    print("Files in test dir (count): ")
    println(files.length)

    # Should have: file1.txt, file2.txt, sub1 (3 items)
    # Print sorted output for consistent test results
    var i: int = 0
    print("Listing contains file1.txt: ")
    var hasFile1: bool = false
    var hasFile2: bool = false
    var hasSub1: bool = false
    for i in 0..files.length =>
        if files[i] == "file1.txt" =>
            hasFile1 = true
        if files[i] == "file2.txt" =>
            hasFile2 = true
        if files[i] == "sub1" =>
            hasSub1 = true
    println(hasFile1)
    print("Listing contains file2.txt: ")
    println(hasFile2)
    print("Listing contains sub1: ")
    println(hasSub1)

    # Test Directory.listRecursive - recursive listing
    var allFiles: str[] = Directory.listRecursive(testDir)
    print("Recursive listing count: ")
    println(allFiles.length)

    # Should have: file1.txt, file2.txt, sub1, sub1/sub2, sub1/subfile.txt (5 items)
    var hasSub2: bool = false
    var hasSubFile: bool = false
    for i in 0..allFiles.length =>
        if allFiles[i] == "sub1/sub2" =>
            hasSub2 = true
        if allFiles[i] == "sub1/subfile.txt" =>
            hasSubFile = true
    print("Recursive listing contains sub1/sub2: ")
    println(hasSub2)
    print("Recursive listing contains sub1/subfile.txt: ")
    println(hasSubFile)

    # Test Directory.delete on empty directory
    var emptyDir: str = Path.join(testDir, "empty")
    Directory.create(emptyDir)
    print("Empty dir exists before delete: ")
    println(Path.exists(emptyDir))
    Directory.delete(emptyDir)
    print("Empty dir exists after delete: ")
    println(Path.exists(emptyDir))

    # Test Directory.deleteRecursive - removes entire tree
    print("Test dir exists before deleteRecursive: ")
    println(Path.exists(testDir))
    Directory.deleteRecursive(testDir)
    print("Test dir exists after deleteRecursive: ")
    println(Path.exists(testDir))

    println("All directory tests completed!")
    return 0

# Test 77: BinaryFile state methods and properties variance testing
fn main(): int =>
    print("Test BinaryFile state methods and properties:\n\n")

    # Setup test file
    var testData: byte[] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
    BinaryFile.writeAll("/tmp/test_bf_77.bin", testData)

    # Test 1: path property
    print("1. path property:\n")
    var f1: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var pathVal: str = f1.path
    print($"  path: '{pathVal}'\n")
    if pathVal == "/tmp/test_bf_77.bin" =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f1.close()

    # Test 2: name property
    print("\n2. name property:\n")
    var f2: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var nameVal: str = f2.name
    print($"  name: '{nameVal}'\n")
    if nameVal == "test_bf_77.bin" =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f2.close()

    # Test 3: size property
    print("\n3. size property:\n")
    var f3: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var sizeVal: int = f3.size
    print($"  size: {sizeVal} bytes\n")
    if sizeVal == 10 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f3.close()

    # Test 4: position() initial
    print("\n4. position() initial:\n")
    var f4: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var pos1: int = f4.position()
    print($"  Initial position: {pos1}\n")
    if pos1 == 0 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f4.close()

    # Test 5: position() after read
    print("\n5. position() after read:\n")
    var f5: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var discard1: int = f5.readByte()
    var discard2: int = f5.readByte()
    var discard3: int = f5.readByte()
    var pos2: int = f5.position()
    print($"  After reading 3 bytes: position = {pos2}\n")
    if pos2 == 3 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f5.close()

    # Test 6: seek()
    print("\n6. seek():\n")
    var f6: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    f6.seek(5)
    var pos3: int = f6.position()
    print($"  After seek(5): position = {pos3}\n")
    if pos3 == 5 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f6.close()

    # Test 7: seek() and read
    print("\n7. seek() and read:\n")
    var f7: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    f7.seek(5)
    var byteAt5: int = f7.readByte()
    print($"  Byte at position 5: {byteAt5}\n")
    if byteAt5 == 5 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f7.close()

    # Test 8: rewind()
    print("\n8. rewind():\n")
    var f8: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var discardBytes: byte[] = f8.readBytes(5)
    var posBefore: int = f8.position()
    f8.rewind()
    var posAfter: int = f8.position()
    print($"  Position before rewind: {posBefore}\n")
    print($"  Position after rewind: {posAfter}\n")
    if posAfter == 0 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f8.close()

    # Test 9: rewind() and re-read
    print("\n9. rewind() and re-read:\n")
    var f9: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    var firstByte1: int = f9.readByte()
    f9.rewind()
    var firstByte2: int = f9.readByte()
    print($"  First read: {firstByte1}\n")
    print($"  After rewind read: {firstByte2}\n")
    if firstByte1 == firstByte2 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f9.close()

    # Test 10: seek to end
    print("\n10. seek to end:\n")
    var f10: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    f10.seek(f10.size)
    print($"  Position after seek to size: {f10.position()}\n")
    print($"  isEof after seek to end: {f10.isEof()}\n")
    if f10.isEof() =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f10.close()

    # Test 11: Empty file state
    print("\n11. Empty file state:\n")
    var emptyData: byte[] = {}
    BinaryFile.writeAll("/tmp/test_bf_77_empty.bin", emptyData)
    var f11: BinaryFile = BinaryFile.open("/tmp/test_bf_77_empty.bin")
    print($"  size on empty: {f11.size}\n")
    print($"  hasBytes on empty: {f11.hasBytes()}\n")
    print($"  isEof on empty: {f11.isEof()}\n")
    if f11.size == 0 && !f11.hasBytes() && f11.isEof() =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f11.close()
    BinaryFile.delete("/tmp/test_bf_77_empty.bin")

    # Test 12: Seek beyond current read position
    print("\n12. Seek forward and backward:\n")
    var f12: BinaryFile = BinaryFile.open("/tmp/test_bf_77.bin")
    f12.seek(8)
    var byte8: int = f12.readByte()
    f12.seek(2)
    var byte2: int = f12.readByte()
    print($"  Byte at 8: {byte8}\n")
    print($"  Byte at 2: {byte2}\n")
    if byte8 == 8 && byte2 == 2 =>
        print("  PASS\n")
    else =>
        print("  FAIL\n")
        return 1
    f12.close()

    # Cleanup
    BinaryFile.delete("/tmp/test_bf_77.bin")

    print("\nAll BinaryFile state method tests passed!\n")
    return 0

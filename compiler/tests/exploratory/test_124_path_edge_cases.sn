// Test 124: Path edge cases
// Tests file I/O with various path formats (relative, absolute, special chars)

fn main(): int =>
    print("Test path edge cases:\n\n")
    var errors: int = 0

    // Test 1: Absolute path
    print("Test 1 - Absolute path:\n")
    var abs_path: str = "/tmp/absolute_path_test.txt"
    TextFile.writeAll(abs_path, "absolute content")
    var abs_content: str = TextFile.readAll(abs_path)
    if abs_content != "absolute content" =>
        print("  FAIL: absolute path read failed\n")
        errors++
    print($"  Absolute path works: {abs_path}\n")
    TextFile.delete(abs_path)

    // Test 2: Path with multiple slashes (normalized)
    print("\nTest 2 - Path with multiple slashes:\n")
    var multi_slash: str = "/tmp//double_slash_test.txt"
    TextFile.writeAll(multi_slash, "multi slash")
    if TextFile.exists(multi_slash) =>
        var multi_content: str = TextFile.readAll(multi_slash)
        print($"  Multi-slash path accepted: {multi_slash}\n")
        TextFile.delete(multi_slash)
    if !TextFile.exists(multi_slash) =>
        print("  Multi-slash path cleaned up correctly\n")

    // Test 3: Path with spaces (requires quoting at shell level, but internal should work)
    print("\nTest 3 - Path with spaces:\n")
    var space_path: str = "/tmp/path with spaces test.txt"
    TextFile.writeAll(space_path, "spaces content")
    if TextFile.exists(space_path) =>
        var space_content: str = TextFile.readAll(space_path)
        if space_content != "spaces content" =>
            print("  FAIL: space path content mismatch\n")
            errors++
        print($"  Space path works\n")
        TextFile.delete(space_path)
    if !TextFile.exists(space_path) =>
        print("  Note: Space paths may have issues\n")

    // Test 4: Path with dots (current/parent directory)
    print("\nTest 4 - Path with dots:\n")
    var dot_path: str = "/tmp/./dot_test.txt"
    TextFile.writeAll(dot_path, "dot content")
    var dot_check_path: str = "/tmp/dot_test.txt"
    if TextFile.exists(dot_check_path) =>
        var dot_content: str = TextFile.readAll(dot_check_path)
        if dot_content != "dot content" =>
            print("  FAIL: dot path content mismatch\n")
            errors++
        print("  Dot path normalized correctly\n")
        TextFile.delete(dot_check_path)

    // Test 5: Path with special characters in filename
    print("\nTest 5 - Special characters in filename:\n")
    var special_path: str = "/tmp/special_file-name_v1.2.3.txt"
    TextFile.writeAll(special_path, "special chars")
    if TextFile.exists(special_path) =>
        var special_content: str = TextFile.readAll(special_path)
        if special_content != "special chars" =>
            print("  FAIL: special path content mismatch\n")
            errors++
        print($"  Special chars work: {special_path}\n")
        TextFile.delete(special_path)

    // Test 6: Path with numbers
    print("\nTest 6 - Path with numbers:\n")
    var num_path: str = "/tmp/file123_456.txt"
    TextFile.writeAll(num_path, "numbers")
    if TextFile.exists(num_path) =>
        var num_content: str = TextFile.readAll(num_path)
        if num_content != "numbers" =>
            print("  FAIL: number path content mismatch\n")
            errors++
        print($"  Number path works: {num_path}\n")
        TextFile.delete(num_path)

    // Test 7: Long filename
    print("\nTest 7 - Long filename:\n")
    var long_name: str = "/tmp/this_is_a_very_long_filename_that_tests_the_limits_of_the_file_system.txt"
    TextFile.writeAll(long_name, "long name content")
    if TextFile.exists(long_name) =>
        var long_content: str = TextFile.readAll(long_name)
        if long_content != "long name content" =>
            print("  FAIL: long name content mismatch\n")
            errors++
        print($"  Long filename works, length: {long_name.length}\n")
        TextFile.delete(long_name)

    // Test 8: Binary file with same path patterns
    print("\nTest 8 - Binary file absolute path:\n")
    var bin_abs: str = "/tmp/binary_abs_test.bin"
    var bin_data: byte[] = {1, 2, 3, 4, 5}
    BinaryFile.writeAll(bin_abs, bin_data)
    var bin_read: byte[] = BinaryFile.readAll(bin_abs)
    if bin_read.length != 5 =>
        print("  FAIL: binary absolute path failed\n")
        errors++
    print($"  Binary absolute path works\n")
    BinaryFile.delete(bin_abs)

    // Test 9: File properties with various paths
    print("\nTest 9 - File properties:\n")
    var prop_path: str = "/tmp/props_test.txt"
    TextFile.writeAll(prop_path, "property test content")
    var pf: TextFile = TextFile.open(prop_path)
    var file_path: str = pf.path
    var file_name: str = pf.name
    print($"  path property: {file_path}\n")
    print($"  name property: {file_name}\n")
    if file_name != "props_test.txt" =>
        print("  FAIL: name should be 'props_test.txt'\n")
        errors++
    pf.close()
    TextFile.delete(prop_path)

    // Test 10: Subdirectory path
    print("\nTest 10 - Subdirectory path:\n")
    // Create a subdirectory structure
    var subdir_path: str = "/tmp/subdir_test/nested_file.txt"
    // Note: Directory needs to exist - may fail if mkdir not available
    // Test if we can at least handle the path string
    print($"  Subdirectory path format: {subdir_path}\n")
    print("  (Actual directory creation requires shell commands)\n")

    // Test 11: Extension variations
    print("\nTest 11 - Various file extensions:\n")
    var exts: str[] = {".txt", ".dat", ".json", ".xml", ".bin", ".log"}
    var ext_idx: int = 0
    shared for ext_idx in 0..6 =>
        var ext_path: str = "/tmp/ext_test" + exts[ext_idx]
        TextFile.writeAll(ext_path, "extension content")
        if TextFile.exists(ext_path) =>
            TextFile.delete(ext_path)
        print($"  Extension {exts[ext_idx]} works\n")

    // Test 12: Copy and move with paths
    print("\nTest 12 - Copy and move operations:\n")
    var src_path: str = "/tmp/copy_src.txt"
    var dst_path: str = "/tmp/copy_dst.txt"
    var moved_path: str = "/tmp/moved_file.txt"

    TextFile.writeAll(src_path, "copy test")
    TextFile.copy(src_path, dst_path)

    if TextFile.exists(dst_path) =>
        var copy_content: str = TextFile.readAll(dst_path)
        if copy_content != "copy test" =>
            print("  FAIL: copy content mismatch\n")
            errors++
        print("  Copy works\n")

    TextFile.move(dst_path, moved_path)
    if !TextFile.exists(dst_path) =>
        print("  Move removes source: correct\n")
    if TextFile.exists(moved_path) =>
        print("  Move creates dest: correct\n")
        TextFile.delete(moved_path)

    TextFile.delete(src_path)

    // Results
    if errors == 0 =>
        print("\nAll path edge case tests PASSED!\n")
    if errors > 0 =>
        print($"\n{errors} tests FAILED!\n")

    return 0

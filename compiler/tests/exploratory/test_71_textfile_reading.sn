# Test 71: TextFile instance reading methods variance testing
fn main(): int =>
    print("Test TextFile instance reading methods:\n\n")

    // Setup: Create test file with known content
    var testContent: str = "Line One\nLine Two\nLine Three\nword1 word2 word3"
    TextFile.writeAll("/tmp/test_tf_71.txt", testContent)

    // Test 1: open and readLine
    print("1. open and readLine:\n")
    var f1: TextFile = TextFile.open("/tmp/test_tf_71.txt")
    var line1: str = f1.readLine()
    print($"  First line: '{line1}'\n")
    if line1 == "Line One" =>
        print("  PASS\n")
    else =>
        print("  FAIL: Expected 'Line One'\n")
        return 1
    f1.close()

    // Test 2: Multiple readLine calls
    print("\n2. Multiple readLine calls:\n")
    var f2: TextFile = TextFile.open("/tmp/test_tf_71.txt")
    var line2a: str = f2.readLine()
    var line2b: str = f2.readLine()
    var line2c: str = f2.readLine()
    var line2d: str = f2.readLine()
    f2.close()
    print($"  Line 1: '{line2a}'\n")
    print($"  Line 2: '{line2b}'\n")
    print($"  Line 3: '{line2c}'\n")
    print($"  Line 4: '{line2d}'\n")
    if line2a == "Line One" && line2b == "Line Two" && line2c == "Line Three" =>
        print("  PASS: Line content correct\n")
    else =>
        print("  FAIL: Line content mismatch\n")
        return 1

    // Test 3: readAll (instance method)
    print("\n3. readAll (instance):\n")
    var f3: TextFile = TextFile.open("/tmp/test_tf_71.txt")
    var all: str = f3.readAll()
    f3.close()
    print($"  readAll length: {all.length}\n")
    if all == testContent =>
        print("  PASS: Content matches\n")
    else =>
        print("  FAIL: Content mismatch\n")
        return 1

    // Test 4: readAll after partial read
    print("\n4. readAll after partial read:\n")
    var f4: TextFile = TextFile.open("/tmp/test_tf_71.txt")
    var firstLine: str = f4.readLine()
    var remaining: str = f4.readAll()
    f4.close()
    print($"  First line: '{firstLine}'\n")
    print($"  Remaining length: {remaining.length}\n")
    if remaining == "Line Two\nLine Three\nword1 word2 word3" =>
        print("  PASS\n")
    else =>
        print("  FAIL: Remaining content mismatch\n")
        return 1

    // Test 5: readLines
    print("\n5. readLines:\n")
    var f5: TextFile = TextFile.open("/tmp/test_tf_71.txt")
    var allLines: str[] = f5.readLines()
    f5.close()
    print($"  Lines array length: {allLines.length}\n")
    if allLines.length == 4 =>
        print("  PASS: 4 lines\n")
    else =>
        print("  FAIL: Expected 4 lines\n")
        return 1
    if allLines[3] == "word1 word2 word3" =>
        print("  PASS: Last line correct\n")
    else =>
        print("  FAIL: Last line mismatch\n")
        return 1

    // Test 6: readWord
    print("\n6. readWord:\n")
    TextFile.writeAll("/tmp/test_tf_71_words.txt", "  alpha  beta\tgamma\ndelta  epsilon  ")
    var f6: TextFile = TextFile.open("/tmp/test_tf_71_words.txt")
    var word6a: str = f6.readWord()
    var word6b: str = f6.readWord()
    var word6c: str = f6.readWord()
    var word6d: str = f6.readWord()
    var word6e: str = f6.readWord()
    f6.close()
    print($"  Word 1: '{word6a}'\n")
    print($"  Word 2: '{word6b}'\n")
    print($"  Word 3: '{word6c}'\n")
    print($"  Word 4: '{word6d}'\n")
    print($"  Word 5: '{word6e}'\n")
    if word6a == "alpha" && word6c == "gamma" && word6e == "epsilon" =>
        print("  PASS: Words correct\n")
    else =>
        print("  FAIL: Word content mismatch\n")
        return 1
    TextFile.delete("/tmp/test_tf_71_words.txt")

    // Test 7: readChar
    print("\n7. readChar:\n")
    TextFile.writeAll("/tmp/test_tf_71_chars.txt", "ABC")
    var f7: TextFile = TextFile.open("/tmp/test_tf_71_chars.txt")
    var c1: int = f7.readChar()
    var c2: int = f7.readChar()
    var c3: int = f7.readChar()
    var c4: int = f7.readChar()
    f7.close()
    print($"  Chars: {c1}, {c2}, {c3}, {c4}\n")
    if c1 == 65 && c2 == 66 && c3 == 67 && c4 == -1 =>
        print("  PASS: A=65, B=66, C=67, EOF=-1\n")
    else =>
        print("  FAIL: Character values wrong\n")
        return 1
    TextFile.delete("/tmp/test_tf_71_chars.txt")

    // Test 8: hasChars state
    print("\n8. hasChars state:\n")
    TextFile.writeAll("/tmp/test_tf_71_has.txt", "XY")
    var f8: TextFile = TextFile.open("/tmp/test_tf_71_has.txt")
    print($"  hasChars before read: {f8.hasChars()}\n")
    var discard1: int = f8.readChar()
    print($"  hasChars after 1 char: {f8.hasChars()}\n")
    var discard2: int = f8.readChar()
    print($"  hasChars after 2 chars: {f8.hasChars()}\n")
    if !f8.hasChars() =>
        print("  PASS: No more chars at EOF\n")
    else =>
        print("  FAIL: Should be no more chars\n")
        return 1
    f8.close()
    TextFile.delete("/tmp/test_tf_71_has.txt")

    // Test 9: isEof state
    print("\n9. isEof state:\n")
    TextFile.writeAll("/tmp/test_tf_71_eof.txt", "Z")
    var f9: TextFile = TextFile.open("/tmp/test_tf_71_eof.txt")
    print($"  isEof at start: {f9.isEof()}\n")
    var readZ: str = f9.readAll()
    print($"  isEof after readAll: {f9.isEof()}\n")
    if f9.isEof() =>
        print("  PASS\n")
    else =>
        print("  FAIL: Should be at EOF\n")
        return 1
    f9.close()
    TextFile.delete("/tmp/test_tf_71_eof.txt")

    // Test 10: Reading empty file
    print("\n10. Reading empty file:\n")
    TextFile.writeAll("/tmp/test_tf_71_empty.txt", "")
    var f10: TextFile = TextFile.open("/tmp/test_tf_71_empty.txt")
    var emptyContent: str = f10.readAll()
    var emptyHasChars: bool = f10.hasChars()
    var emptyIsEof: bool = f10.isEof()
    f10.close()
    print($"  Empty content length: {emptyContent.length}\n")
    print($"  hasChars on empty: {emptyHasChars}\n")
    print($"  isEof on empty: {emptyIsEof}\n")
    if emptyContent == "" =>
        print("  PASS: Empty string returned\n")
    else =>
        print("  FAIL: Should be empty\n")
        return 1
    TextFile.delete("/tmp/test_tf_71_empty.txt")

    // Cleanup
    TextFile.delete("/tmp/test_tf_71.txt")

    print("\nAll TextFile reading method tests passed!\n")
    return 0
